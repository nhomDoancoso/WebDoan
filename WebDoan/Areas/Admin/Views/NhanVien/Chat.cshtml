@{
    ViewBag.Title = "Chat";
}

<section style="background-color: #eee; height:100vh">
    <div class="container py-5">

        <div class="row d-flex justify-content-center">
            <div class="col-md-8 col-lg-6 col-xl-4">

                <div class="card" id="chat1" style="border-radius: 15px;">
                    <div class="card-header d-flex justify-content-between align-items-center p-3 bg-info text-white border-bottom-0"
                         style="border-top-left-radius: 15px; border-top-right-radius: 15px;">
                        <p class="mb-0 fw-bold">Live chat</p>
                    </div>
                    <div class="card-body">
                        <ul id="discussion">
                        </ul>

                        <input type="hidden" id="username" value="@Session["User"]" />

                    </div>
                    <div class="form-outline" style="padding:1rem; display:flex">
                        <input type="text" style="margin-right:1rem" id="message" class="form-control" placeholder="Type your message" />
                        <input class="btn <b></b>tn-success" style="background-color: #0dcaf0;color:#fff; border:none" type="button" id="sendmessage" value="Send" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
@section scripts {
    <script src="~/Scripts/jquery.signalR-2.4.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            var userName = $('#username').val();
            var UsernameImg = $('#usernameImg').attr('src');

            // Reference the auto-generated proxy for the hub.  
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.
            chat.client.addNewMessageToPage = function (name, message) {
                // Add the message to the page. 
                $('#discussion').append(
                    '<li style=" list-style: none;"><strong>'
                    + htmlEncode(name)
                    + '</strong>: '
                    + htmlEncode(message)
                    + '</li>');
            };
            // Set initial focus to message input box.  
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {
                    // Call the Send method on the hub. 
                    chat.server.send(userName, $('#message').val());
                    // Clear text box and reset focus for next comment. 
                    $('#message').val('').focus();
                });
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}